<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Order</title>
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
          integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css"
          rel="stylesheet" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
    <style>
        .error,
        .require {
            color: red;
            font-size: 0.875em;
            display: block;
        }
    </style>
    <link th:href="@{/css/style.css}" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
<div th:replace="~{fragments/navbar :: barNav}"></div>
<div class="d-flex">
    <div th:replace="~{fragments/sidebar :: barSide}"></div>

    <div class="container">
        <h3 class="my-4 text-center">Edit Order</h3>
        <div class="d-flex justify-content-end">
            <a class="btn btn-primary" th:href="@{/order/view}">View Order</a>
        </div>
        <form id="orderForm" onsubmit="return updateOrderSubmit()" th:action="@{/order/update}" th:object="${orderDto}" method="post">
            <div class="row mb-3">
                <div class="col-md-4">
                    <input type="hidden" name="id" th:field="*{id}" />
                    <label for="voucherType" class="form-label required">Voucher Type <span class="require"
                                                                                            style="display: inline">*</span></label>
                    <select id="voucherType" th:field="*{voucherTypeName}" class="form-select"
                            onblur="validateOrderType()" required>
                        <option value="" selected>Select Voucher Type</option>
                        <option value="Sales">Sales Order</option>
                        <option value="Purchase Order">Purchase Order</option>
                    </select>
                    <div id="orderTypeError" class="error" style="display:none;">Please select a Voucher Type</div>
                </div>

                <div class="col-md-4">
                    <label for="customer" class="form-label">Customer Name <span class="require"
                                                                                 style="display: inline">*</span></label>
                    <select id="customer" th:field="*{customerName}" class="selectpicker form-control"
                            data-live-search="true" onblur="validateCustomerName()" required>
                        <option value="" selected>Select Customer</option>
                        <option th:each="customerName : ${customerNames}" th:value="${customerName}"
                                th:text="${customerName}"></option>
                    </select>
                    <div id="customerError" class="error" style="display:none;">Please select a customer</div>
                </div>

                <div class="col-md-4">
                    <label for="customerPayableAmount" class="form-label">Customer Payable Amount</label>
                    <input type="text" th:field="*{customerPayableAmount}" class="form-control form-control-sm"
                           id="customerPayableAmount" />
                </div>

            </div>

            <div class="row mb-3">

                <div class="col-md-4">
                    <label for="purchaseOrderNumber" class="form-label">Purchase Order Number</label>
                    <input type="text" th:field="*{purchaseOrderNumber}" class="form-control form-control-sm"
                           id="purchaseOrderNumber" />
                </div>

                <div class="col-md-4">
                    <label for="groupName" class="form-label">Product Group Name <span class="require"
                                                                                       style="display: inline">*</span></label>
                    <select class="selectpicker form-control" data-live-search="true" id="groupName" name="make"
                            th:field="*{groupName}" onchange="fetchMake()" oninput="validateGroupName()" required>
                        <option value="" selected>Select Group Name</option>
                        <option th:each="groupName : ${groupNames}" th:value="${groupName}" th:text="${groupName}">
                        </option>
                    </select>
                    <div id="groupNameError" class="error" style="display:none;">Please select a Product Group Name
                    </div>

                </div>

                <div class="col-md-4">
                    <label for="make" class="form-label">Make <span class="require"
                                                                    style="display: inline">*</span></label>
                    <select class="selectpicker form-control" data-live-search="true" id="make" name="make"
                            th:field="*{make}" onchange="fetchModels()" onblur="validateMake()" required>
                         <option th:each="m : ${makes}" th:value="${m}" th:text="${m}"></option>
                    </select>
                    <div id="makeError" class="error" style="display:none;">Please select a Make</div>
                </div>

                <div class="col-md-4">
                    <label for="model" class="form-label">Model <span class="require"
                                                                      style="display: inline">*</span></label>
                    <select class="selectpicker form-control" data-live-search="true" id="model" name="model"
                            th:field="*{model}" onchange="fetchProductCodes()" onblur="validateModel()" required>
                         <option th:each="m : ${models}" th:value="${m}" th:text="${m}"></option>
                    </select>
                    <div id="modelError" class="error" style="display:none;">Please select a Model</div>
                </div>
                <div class="col-md-4">
                    <label for="productCode" class="form-label">Product Code <span class="require"
                                                                                   style="display: inline">*</span></label>
                    <select class="selectpicker form-control" data-live-search="true" id="productCode"
                            name="productCode" th:field="*{productCode}" onchange="fetchPriceAndStock()" onblur="validateProductCode()" required>
                         <option th:each="m : ${productCodes}" th:value="${m}" th:text="${m}"></option>
                    </select>
                    <div id="productCodeError" class="error" style="display:none;">Please select a Product Code

                    </div>
                </div>
                <div class="col-md-4">
                    <label for="itemName" class="form-label">Item Name
                    </label>
                    <input type="text" th:field="*{itemName}" class="form-control form-control-sm" id="itemName"
                           readonly />
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="openingValue" class="form-label">Opening Value(Initial Price)</label>
                    <input type="text" class="form-control form-control-sm" id="openingValue"
                           th:field="*{openingValue}" readonly />
                </div>

                <div class="col-md-4">
                    <label for="openingBalance" class="form-label">Opening Balance(Stock-in-hand)</label>
                    <input type="text" class="form-control form-control-sm" id="openingBalance"
                           th:field="*{openingBalance}" readonly />
                </div>

                <div class="col-md-4">
                    <label for="sellingPrice" class="form-label">Selling Price <span class="require"
                                                                                     style="display: inline">*</span></label>
                    <input type="text" class="form-control form-control-sm" id="sellingPrice"
                           th:field="*{sellingPrice}" oninput="validateSellingPrice();calculateTotalPrice()" onblur="validateNarration()" required/>
                    <div id="sellingPriceError" class="error" style="display:none;"></div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="orderDueDate" class="form-label required">Order Due Date <span class="require"
                                                                                               style="display: inline">*</span></label>
                    <input type="date"  th:name="orderDueDate" id="orderDueDate" th:value="*{orderDueDate}"   class="form-control" required  />
                </div>


                <div class="col-md-4">
                    <label for="narration" class="form-label">Narration</label>
                    <textarea id="narration" class="form-control" th:field="*{narration}"
                              placeholder="Enter narration for the order" required></textarea>
                    <span id="narrationError" class="error"></span>
                </div>
                <div class="col-md-4">
                    <label for="quantity" class="form-label">Quantity</label>
                    <span class="require" style="display: inline">*</span>
                    <input type="text" class="form-control form-control-sm" id="quantity"
                           placeholder="Enter Quantity (numbers only) no decimal points" name="quantity"
                           th:field="*{quantity}"
                           oninput="this.value = this.value.replace(/[^0-9]/g, ''); validateQuantity();"
                           onblur="calculateTotalPrice()" required />
                    <div id="quantityError1" class="error" style="display:none;">
                        Please Enter Quantity
                    </div>
                    <div id="quantityError2" class="error" style="display:none;">
                        Quantity should not contain decimal point
                    </div>
                    <div id="quantityError3" class="error" style="display:none;">
                        Out of stock
                    </div>
                </div>
                <div class="col-md-4">
                    <label for="totalPrice" class="form-label">Total Price</label>
                    <input type="text" class="form-control form-control-sm" id="totalPrice" name="totalPrice"
                           th:field="*{totalPrice}" readonly />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Is Invoice</label><br />
                    <input type="radio" class="form-check-input" id="isInvoiceYes" name="isInvoice" value="Yes" th:field="*{isInvoice}" />
                    <label for="isInvoiceYes">Yes</label>
                    <input type="radio" class="form-check-input" id="isInvoiceNo" name="isInvoice" value="No" th:field="*{isInvoice}" />
                    <label for="isInvoiceNo">No</label>
                    <div id="isInvoiceError" class="error" style="display:none;">
                        Please select an invoice option.
                    </div>
                </div>
            </div>

            <input type="hidden" th:field="*{orderGuid}"  />
            <input type="hidden" th:field="*{createdBy}"  />
            <input type="hidden" th:field="*{createdOn}"  />

            <div class="mb-3 text-center">
                <button type="submit" class="btn btn-primary btn-sm">
                    Update
                </button>
                <a th:href="@{/order/view}">
                    <button type="button" class="btn btn-secondary btn-sm">
                        Cancel
                    </button>
                </a>
            </div>
    </form>
</div>
</div>

<div th:replace="~{fragments/footer :: footerBar}"></div>
<script type="text/javascript" th:src="@{/js/order.js}"></script>
<script type="text/javascript" th:src="@{/js/urlConstant.js}"></script>
<script type="text/javascript" th:src="@{/js/script.js}"></script>

</body>

</html>